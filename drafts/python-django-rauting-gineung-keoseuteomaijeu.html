<!DOCTYPE html><html lang=en><head><title>MUTEKLAB - Python Django 라우팅 기능 커스터마이즈</title><meta charset=utf-8><meta content="IE=edge,chrome=1" http-equiv=X-UA-Compatible><meta charset=utf-8 content=text/html http-equiv=Content-Type><meta content="Taehong Kim" name=author><meta content=origin name=referrer><meta content=Pelican name=generator><meta content=#000000 name=theme-color><meta content=#000000 name=msapplication-navbutton-color><meta content=#000000 name=apple-mobile-web-app-status-bar-style><meta content=True name=HandheldFriendly><meta content="width=device-width, initial-scale=1.0" name=viewport><meta content=UJrW4UdiO-oEmH_o6fBNi4az0ooqxSFHNJs6RxFqa80 name=google-site-verification><link href=http://muteklab.com/drafts/python-django-rauting-gineung-keoseuteomaijeu.html rel=canonical><meta content="Python Django 프로젝트에서 urls.py의 라우팅 기능을 커스터마이즈하는 방법을 소개합니다. Monolithic Architecture에서 유용하게 사용할 수 있는 방법입 …" name=description><link href=/static/images/favicon.ico rel="shortcut icon"><script src=https://www.gstatic.com/firebasejs/7.6.1/firebase-app.js></script><script src=https://www.gstatic.com/firebasejs/7.6.1/firebase-firestore.js></script><script src=https://www.gstatic.com/firebasejs/7.6.1/firebase-analytics.js></script><!-- <script async src="https://www.googletagmanager.com/gtag/js?id=G-NCJZCXBKLS"></script> --><script src=/static/js/jquery.min.js type=text/javascript></script><script src=/static/js/common-menu.min.js type=text/javascript></script><script src=/static/js/md5.min.js></script><script src=/static/js/moment-with-locales.min.js type=text/javascript></script><link href=/static/css/code_blocks/github.min.css rel=stylesheet type=text/css><link href=/static/css/common.min.css rel=stylesheet type=text/css><link href=/static/css/common-menu.min.css rel=stylesheet type=text/css><link href=/static/css/common-icons.min.css rel=stylesheet type=text/css><link href=/static/css/common-alert.min.css rel=stylesheet type=text/css><link href=/static/css/common-footer.min.css rel=stylesheet type=text/css><link href=/static/css/common-pagination.min.css rel=stylesheet type=text/css><link href=/static/css/article-content.min.css rel=stylesheet type=text/css><link href=/static/css/article-loop.min.css rel=stylesheet type=text/css><link href=/static/css/article-nav.min.css rel=stylesheet type=text/css><link href=/static/css/article-comment.min.css rel=stylesheet type=text/css><script type=text/javascript>let ua=window.navigator.userAgent;if(ua.indexOf('MSIE ')>0||ua.indexOf('Trident/')>0||ua.indexOf('Edge/')>0){$('head').append('<script src="/static/js/audio-player-ie.min.js"><\/script>');$('head').append('<script src="/static/js/youtube-embed-ie.min.js"><\/script>');}else{$('head').append('<script src="/static/js/comment.min.js""><\/script>');$('head').append('<script src="/static/js/audio-player.min.js"><\/script>');$('head').append('<script src="/static/js/youtube-embed.min.js"><\/script>');}
var firebaseConfig={apiKey:"AIzaSyCKt3z0JCmxteYhxs93rsMtOqkb4_I8Em4",authDomain:"muteklab-com.firebaseapp.com",databaseURL:"https://muteklab-com.firebaseio.com",projectId:"muteklab-com",storageBucket:"muteklab-com.appspot.com",messagingSenderId:"358862433613",appId:"1:358862433613:web:6bc27b27018c4ae5",measurementId:"G-NCJZCXBKLS"};firebase.initializeApp(firebaseConfig);firebase.analytics();</script><meta content=article property=og:type><meta content="Python Django 라우팅 기능 커스터마이즈" property=og:title><meta content="Python Django 프로젝트에서 urls.py의 라우팅 기능을 커스터마이즈하는 방법을 소개합니다. Monolithic Architecture에서 유용하게 사용할 수 있는 방법입 …" property=og:description><meta content=http://muteklab.com/static/images/favicon.png property=og:image><meta content=http://muteklab.com/drafts/python-django-rauting-gineung-keoseuteomaijeu.html property=og:url><meta content="Taehong Kim" property=article:author><meta content="2019-08-24 00:00:00+09:00" property=article:published_time></head><body><div class=navbar><div class=container><a href=/ class=navbar-brand><img src=/static/images/logo-muteklab.svg></a><div class=navbar-header><button class=navbar-toggle><span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button></div><div class=navbar-modal-mask></div><div class=navbar-menu><div class=dropdown><button class=dropdown-toggle> Author<b class=caret></b></button><div class=dropdown-menu><a href=/authors-information.html>Information</a><div class=divider></div><a href=/category/authors-music.html>Music</a><a href=/category/authors-mixset.html>Mixset</a><a href=/category/authors-development.html>Development</a></div></div><div class=dropdown><button class=dropdown-toggle> Articles<b class=caret></b></button><div class=dropdown-menu><a href=/category/music-articles.html>Music</a><a href=/category/development-articles.html>Development</a></div></div><div class=dropdown><button class=dropdown-toggle> Find<b class=caret></b></button><div class=dropdown-menu><a href=/archives.html>Archives</a><a href=/categories.html>Categories</a><a href=/tags.html>Tags</a></div></div></div></div></div><header class=article-header><div class=container><div class=header-title>Python Django 라우팅 기능 커스터마이즈</div><!-- <span class="blog-description"></span> --><span class=article-meta><div class=group><a href=/category/development-articles.html> Development Articles </a><span class=seperator>|</span><time datetime=2019-08-24>2019-08-24</time></div></span></div></header><input id=article-url type=hidden value=drafts/python-django-rauting-gineung-keoseuteomaijeu.html><main class=content><div class=container><section class=article-content><!-- Status: hidden --><p>Python Django 프로젝트에서 <code>urls.py</code>의 라우팅 기능을 커스터마이즈하는 방법을 소개합니다. Monolithic Architecture에서 유용하게 사용할 수 있는 방법입니다. 공식적인 Django 예제에서는 정규식 기반으로 라우팅하는 예제를 주로 다룹니다. 그래서 인지 <code>urls.py</code> 내에 라우팅 규칙을 담은 함수나 클래스를 적용할 수 있다는 사실을 잊고 views에서 복잡하게 처리하는 경우를 종종 볼 수 있습니다. 가령 회사 소개 웹 서비스, 제품에 대한 웹 서비스, 모바일 앱 서비스 API 등 각각의 접근 도메인 주소가 다른 경우를 가정합니다. urlpatterns에 url을 등록할 때는 도메인 주소를 제외한 path만 지정할 수 있으나 다음과 같은 방법을 사용하면 도메인 주소를 사용하여 라우팅 할 수 있게 됩니다. <code>UrlParser</code> 클래스는 서비스 아키텍처에 따라 간소하게 구현할 수도 있겠습니다.</p><h6></h6><p><code>urls.py</code></p><div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>django.conf.urls</span> <span class=kn>import</span> <span class=n>url</span>
<span class=kn>from</span> <span class=nn>urlparser</span> <span class=kn>import</span> <span class=n>UrlParser</span>


<span class=n>ROOT_DOMAIN_ROUTES</span> <span class=o>=</span> <span class=p>{</span>
    <span class=s1>'company-web'</span><span class=p>:</span> <span class=p>[</span><span class=s1>'company-web-domain.com'</span><span class=p>,</span> <span class=s1>'company-web-domain.co.kr'</span><span class=p>],</span>
    <span class=s1>'app-001-web'</span><span class=p>:</span> <span class=p>[</span><span class=s1>'app-001-web-domain.com'</span><span class=p>],</span>
    <span class=s1>'app-001-api'</span><span class=p>:</span> <span class=p>[</span><span class=s1>'app-001-api-domain.com'</span><span class=p>],</span>
    <span class=s1>'app-002-web'</span><span class=p>:</span> <span class=p>[</span><span class=s1>'app-002-web-domain.com'</span><span class=p>],</span>
    <span class=s1>'app-002-api'</span><span class=p>:</span> <span class=p>[</span><span class=s1>'app-002-api-domain.com'</span><span class=p>],</span>
<span class=p>}</span>


<span class=k>class</span> <span class=nc>RootDomainRouter</span><span class=p>():</span>

    <span class=k>def</span> <span class=fm>__call__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request</span><span class=p>):</span>
        <span class=n>url</span> <span class=o>=</span> <span class=n>UrlParser</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>get_host</span><span class=p>())</span>
        <span class=k>for</span> <span class=n>path</span><span class=p>,</span> <span class=n>domains</span> <span class=ow>in</span> <span class=n>ROOT_DOMAIN_ROUTES</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
            <span class=k>if</span> <span class=n>url</span><span class=o>.</span><span class=n>rootdomain</span> <span class=ow>in</span> <span class=n>domains</span><span class=p>:</span>
                <span class=k>pass</span>


<span class=n>urlpatterns</span> <span class=o>=</span> <span class=p>[</span>
    <span class=n>url</span><span class=p>(</span><span class=sa>r</span><span class=s1>'^$'</span><span class=p>,</span> <span class=n>RootDomainRouter</span><span class=p>()),</span>
<span class=p>]</span>
</code></pre></div><h6></h6><p><code>urlparser.py</code></p><div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>re</span>


<span class=k>class</span> <span class=nc>UrlParser</span><span class=p>:</span>

    <span class=n>scheme</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=n>subdomain</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=n>domain</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=n>topdomain</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=n>rootdomain</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=n>port</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=n>path</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=n>paths</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=n>param</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=n>params</span> <span class=o>=</span> <span class=p>{}</span>

    <span class=n>pattern</span> <span class=o>=</span> <span class=p>(</span><span class=sa>r</span><span class=s1>'''^([a-zA-Z]{1,}://){0,1}'''</span>
               <span class=sa>r</span><span class=sd>'''([a-zA-Z0-9\.]{1,}[\.]{1}){0,1}'''</span>
               <span class=sa>r</span><span class=sd>'''([a-zA-Z0-9\-]{4,})\.'''</span>
               <span class=sa>r</span><span class=sd>'''([a-zA-Z0-9]{1,}[\.]{0,1}[a-zA-Z0-9]{0,})'''</span>
               <span class=sa>r</span><span class=sd>'''([:]{1,}[0-9]{1,6}){0,1}'''</span>
               <span class=sa>r</span><span class=sd>'''(\/[a-zA-Z0-9\_\-\.\/]{1,}){0,1}'''</span>
               <span class=sa>r</span><span class=sd>'''(\?[\w\d\W\D\&amp;]{1,}){0,1}'''</span><span class=p>)</span>

    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>url</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>url</span> <span class=o>=</span> <span class=n>url</span>
        <span class=n>result</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>pattern</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>url</span><span class=p>)</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=n>result</span><span class=p>:</span>
            <span class=k>return</span>

        <span class=n>scheme</span><span class=p>,</span> <span class=n>subdomain</span><span class=p>,</span> <span class=n>domain</span><span class=p>,</span> <span class=n>topdomain</span><span class=p>,</span> <span class=n>port</span><span class=p>,</span> <span class=n>path</span><span class=p>,</span> <span class=n>param</span> <span class=o>=</span> <span class=n>result</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>scheme</span> <span class=o>=</span> <span class=n>scheme</span><span class=o>.</span><span class=n>strip</span><span class=p>(</span><span class=s1>' :/'</span><span class=p>)</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>subdomain</span> <span class=o>=</span> <span class=n>subdomain</span><span class=o>.</span><span class=n>strip</span><span class=p>(</span><span class=s1>' .:'</span><span class=p>)</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>domain</span> <span class=o>=</span> <span class=n>domain</span><span class=o>.</span><span class=n>strip</span><span class=p>(</span><span class=s1>' .:'</span><span class=p>)</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>topdomain</span> <span class=o>=</span> <span class=n>topdomain</span><span class=o>.</span><span class=n>strip</span><span class=p>(</span><span class=s1>' .:'</span><span class=p>)</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>port</span> <span class=o>=</span> <span class=n>port</span><span class=o>.</span><span class=n>strip</span><span class=p>(</span><span class=s1>' .:'</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>rootdomain</span> <span class=o>=</span> <span class=s1>'.'</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=bp>self</span><span class=o>.</span><span class=n>domain</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>topdomain</span><span class=p>])</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>host</span> <span class=o>=</span> <span class=s1>':'</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=s1>'.'</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=bp>self</span><span class=o>.</span><span class=n>subdomain</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>rootdomain</span><span class=p>]),</span> <span class=bp>self</span><span class=o>.</span><span class=n>port</span><span class=p>])</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>path</span> <span class=o>=</span> <span class=n>path</span>
        <span class=n>paths</span> <span class=o>=</span> <span class=p>[</span><span class=n>v</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span> <span class=k>for</span> <span class=n>v</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>'/'</span><span class=p>)]</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>paths</span> <span class=o>=</span> <span class=p>[</span><span class=n>v</span> <span class=k>for</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>paths</span> <span class=k>if</span> <span class=n>v</span><span class=p>]</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>param</span> <span class=o>=</span> <span class=n>param</span><span class=o>.</span><span class=n>strip</span><span class=p>(</span><span class=s1>'?'</span><span class=p>)</span>
        <span class=n>params</span> <span class=o>=</span> <span class=p>[</span><span class=n>v</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span> <span class=k>for</span> <span class=n>v</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>param</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>'&amp;'</span><span class=p>)]</span>

        <span class=k>for</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>params</span><span class=p>:</span>
            <span class=n>keyvalue</span> <span class=o>=</span> <span class=n>v</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>'='</span><span class=p>)</span>
            <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>keyvalue</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
                <span class=n>keyvalue</span> <span class=o>+=</span> <span class=p>[</span><span class=s1>''</span><span class=p>]</span>
            <span class=n>key</span><span class=p>,</span> <span class=n>value</span> <span class=o>=</span> <span class=n>keyvalue</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>params</span><span class=o>.</span><span class=n>update</span><span class=p>({</span><span class=n>key</span><span class=p>:</span> <span class=n>value</span><span class=p>})</span>


<span class=k>def</span> <span class=nf>__test__</span><span class=p>(</span><span class=n>url</span><span class=p>):</span>
    <span class=n>url</span> <span class=o>=</span> <span class=n>UrlParser</span><span class=p>(</span><span class=n>url</span><span class=p>)</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>url</span><span class=o>.</span><span class=n>scheme</span><span class=p>)</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>url</span><span class=o>.</span><span class=n>subdomain</span><span class=p>)</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>url</span><span class=o>.</span><span class=n>rootdomain</span><span class=p>)</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>url</span><span class=o>.</span><span class=n>host</span><span class=p>)</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>url</span><span class=o>.</span><span class=n>paths</span><span class=p>)</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>url</span><span class=o>.</span><span class=n>params</span><span class=p>)</span>


<span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>'__main__'</span><span class=p>:</span>
    <span class=n>url</span> <span class=o>=</span> <span class=p>(</span><span class=s1>'https://sub.root.co.kr:8080/admin/name/update/'</span>
           <span class=s1>'?firstname=Taehong&amp;lastname=Kim&amp;nickname'</span><span class=p>)</span>
    <span class=n>__test__</span><span class=p>(</span><span class=n>url</span><span class=p>)</span>
</code></pre></div></section><aside class=article-nav><a class="article-nav-left article-nav-left-empty"></a><div class=clear></div></aside><div class=article-comment><div class=comment-title><div class=comment-count></div></div><div class=comment-input><div class=comment-body><textarea id=comment-content placeholder="Comment (at least 3 chars)" type=text></textarea></div><div class=comment-foot><input id=comment-username placeholder="Name (optional)" type=text><input id=comment-email placeholder="Email (optional)" type=text><button id=comment-submit-button onclick=onClickSubmitCommentButton()>Submit</button></div></div><div class=comment-list></div></div> </div></main><footer class=footer><div class=container><div class=credits><div class=group-container><div class=group><a class=avatar href=/authors-information.html><img class=avatar src="https://avatars1.githubusercontent.com/u/21299773?s=460&v=4"></a></div><div class=group><a href=/category/authors-music.html> Author's Music </a><a href=/category/authors-mixset.html> Author's Mixset </a><a href=/category/authors-development.html> Author's Development </a></div></div><div class=group-container><div class=group><a href=/category/music-articles.html> Music Articles </a><a href=/category/development-articles.html> Development Articles </a></div><div class=group><a href=/archives.html> Find in Archives </a><a href=/categories.html> Find in Categories </a><a href=/tags.html> Find in Tags </a></div><div class=group><a href=https://github.com/peppy0510 target=_blank>GitHub</a></div></div></div></div></footer></body></html>