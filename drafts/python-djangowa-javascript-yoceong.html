<!DOCTYPE html><html lang=en><head><title>MUTEKLAB - Python Django와 JavaScript 요청</title><meta charset=utf-8><meta content="IE=edge,chrome=1" http-equiv=X-UA-Compatible><meta charset=utf-8 content=text/html http-equiv=Content-Type><meta content="Taehong Kim" name=author><meta content=origin name=referrer><meta content=Pelican name=generator><meta content=#000000 name=theme-color><meta content=#000000 name=msapplication-navbutton-color><meta content=#000000 name=apple-mobile-web-app-status-bar-style><meta content=True name=HandheldFriendly><meta content="width=device-width, initial-scale=1.0" name=viewport><meta content=UJrW4UdiO-oEmH_o6fBNi4az0ooqxSFHNJs6RxFqa80 name=google-site-verification><link href=http://muteklab.com/drafts/python-djangowa-javascript-yoceong.html rel=canonical><meta content="Python Django에서 JavaScript POST 요청을 유연하게 대응하기 위해 사용하는 방법을 설명한다. Django에서 Ajax와 Angular의 POST 요청을 각각 다르게 구분하여 …" name=description><link href=/static/images/favicon.ico rel="shortcut icon"><script src=https://www.gstatic.com/firebasejs/7.6.1/firebase-app.js></script><script src=https://www.gstatic.com/firebasejs/7.6.1/firebase-firestore.js></script><script src=https://www.gstatic.com/firebasejs/7.6.1/firebase-analytics.js></script><!-- <script async src="https://www.googletagmanager.com/gtag/js?id=G-NCJZCXBKLS"></script> --><script src=/static/js/jquery.min.js type=text/javascript></script><script src=/static/js/common-menu.min.js type=text/javascript></script><script src=/static/js/md5.min.js></script><script src=/static/js/moment-with-locales.min.js type=text/javascript></script><link href=/static/css/code_blocks/github.min.css rel=stylesheet type=text/css><link href=/static/css/common.min.css rel=stylesheet type=text/css><link href=/static/css/common-menu.min.css rel=stylesheet type=text/css><link href=/static/css/common-icons.min.css rel=stylesheet type=text/css><link href=/static/css/common-alert.min.css rel=stylesheet type=text/css><link href=/static/css/common-footer.min.css rel=stylesheet type=text/css><link href=/static/css/common-pagination.min.css rel=stylesheet type=text/css><link href=/static/css/article-content.min.css rel=stylesheet type=text/css><link href=/static/css/article-loop.min.css rel=stylesheet type=text/css><link href=/static/css/article-nav.min.css rel=stylesheet type=text/css><link href=/static/css/article-comment.min.css rel=stylesheet type=text/css><script type=text/javascript>let ua=window.navigator.userAgent;if(ua.indexOf('MSIE ')>0||ua.indexOf('Trident/')>0||ua.indexOf('Edge/')>0){$('head').append('<script src="/static/js/audio-player-ie.min.js"><\/script>');$('head').append('<script src="/static/js/youtube-embed-ie.min.js"><\/script>');}else{$('head').append('<script src="/static/js/comment.min.js""><\/script>');$('head').append('<script src="/static/js/audio-player.min.js"><\/script>');$('head').append('<script src="/static/js/youtube-embed.min.js"><\/script>');}
var firebaseConfig={apiKey:"AIzaSyCKt3z0JCmxteYhxs93rsMtOqkb4_I8Em4",authDomain:"muteklab-com.firebaseapp.com",databaseURL:"https://muteklab-com.firebaseio.com",projectId:"muteklab-com",storageBucket:"muteklab-com.appspot.com",messagingSenderId:"358862433613",appId:"1:358862433613:web:6bc27b27018c4ae5",measurementId:"G-NCJZCXBKLS"};firebase.initializeApp(firebaseConfig);firebase.analytics();</script><meta content=article property=og:type><meta content="Python Django와 JavaScript 요청" property=og:title><meta content="Python Django에서 JavaScript POST 요청을 유연하게 대응하기 위해 사용하는 방법을 설명한다. Django에서 Ajax와 Angular의 POST 요청을 각각 다르게 구분하여 …" property=og:description><meta content=http://muteklab.com/static/images/favicon.png property=og:image><meta content=http://muteklab.com/drafts/python-djangowa-javascript-yoceong.html property=og:url><meta content="Taehong Kim" property=article:author><meta content="2019-08-24 00:00:00+09:00" property=article:published_time></head><body><div class=navbar><div class=container><a href=/ class=navbar-brand><img src=/static/images/logo-muteklab.svg></a><div class=navbar-header><button class=navbar-toggle><span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button></div><div class=navbar-modal-mask></div><div class=navbar-menu><div class=dropdown><button class=dropdown-toggle> Author<b class=caret></b></button><div class=dropdown-menu><a href=/authors-information.html>Information</a><div class=divider></div><a href=/category/authors-music.html>Music</a><a href=/category/authors-mixset.html>Mixset</a><a href=/category/authors-development.html>Development</a></div></div><div class=dropdown><button class=dropdown-toggle> Articles<b class=caret></b></button><div class=dropdown-menu><a href=/category/music-articles.html>Music</a><a href=/category/development-articles.html>Development</a></div></div><div class=dropdown><button class=dropdown-toggle> Find<b class=caret></b></button><div class=dropdown-menu><a href=/archives.html>Archives</a><a href=/categories.html>Categories</a><a href=/tags.html>Tags</a></div></div></div></div></div><header class=article-header><div class=container><div class=header-title>Python Django와 JavaScript 요청</div><!-- <span class="blog-description"></span> --><span class=article-meta><div class=group><a href=/category/development-articles.html> Development Articles </a><span class=seperator>|</span><time datetime=2019-08-24>2019-08-24</time></div></span></div></header><input id=article-url type=hidden value=drafts/python-djangowa-javascript-yoceong.html><main class=content><div class=container><section class=article-content><p>Python Django에서 JavaScript POST 요청을 유연하게 대응하기 위해 사용하는 방법을 설명한다. Django에서 Ajax와 Angular의 POST 요청을 각각 다르게 구분하여 대응해야 하는 경우가 발생한다. Angular 요청 시 Django에서는 POST 데이터가 <code>request.POST</code>에 담겨 있지 않고 <code>request.body</code>에 담겨 있는 경우가 있다. 이러한 증상이 특정 Angular 버전의 버그인지 혹은 Django의 버그인지는 확인하지 못했다. Angular 요청의 헤더 기본 정의가 표준적이지 않고 Django 자체에서도 POST를 유연하게 판별하지 못해내는 문제인 것 같았다. 다양한 클라이언트에서 접근하는 API를 개발하다 보니 유연하게 동작하도록 구현해야 할 필요성을 가지게 되었다. 추가로 클라이언트에서 요청 시 편리함을 위하여, 새로이 요청 데이터 변수를 생성하지 않고, 여러 변수가 포함된 Object를 그대로 JSON 인코딩하여 서버로 요청하기도 한다. 이때 불필요한 해시 키가 포함된다. 사실 그대로 두어도 상관은 없으나, 개인적으로는 불필요한 JavaScript 해시 키를 깔끔하게 제거하여 처리부로 넘겨주고 싶었다. 다음과 같이 전처리한 후 데이터를 사용하면 된다.</p><div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>json</span>


<span class=k>def</span> <span class=nf>remove_javascript_hashkey</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>keyword</span><span class=o>=</span><span class=s1>'$$hashKey'</span><span class=p>):</span>
    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=nb>list</span><span class=p>):</span>
        <span class=p>[</span><span class=n>v</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=n>keyword</span><span class=p>)</span> <span class=k>for</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>data</span> <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=nb>dict</span><span class=p>)</span> <span class=ow>and</span> <span class=s1>'$$hashKey'</span> <span class=ow>in</span> <span class=n>v</span><span class=p>]</span>
    <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=nb>dict</span><span class=p>):</span>
        <span class=p>[</span><span class=n>remove_javascript_hashkey</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=n>key</span><span class=p>])</span> <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>data</span><span class=o>.</span><span class=n>keys</span><span class=p>()]</span>


<span class=k>class</span> <span class=nc>ViewsBase</span><span class=p>():</span>

    <span class=k>def</span> <span class=fm>__call__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>

        <span class=k>if</span> <span class=n>request</span><span class=o>.</span><span class=n>method</span> <span class=o>==</span> <span class=s1>'POST'</span><span class=p>:</span>
            <span class=c1># ajax http request</span>
            <span class=k>if</span> <span class=s1>'json'</span> <span class=ow>in</span> <span class=n>request</span><span class=o>.</span><span class=n>POST</span> <span class=ow>and</span> <span class=nb>len</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>POST</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
                <span class=n>data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>POST</span><span class=p>[</span><span class=s1>'json'</span><span class=p>])</span>
            <span class=c1># angular http request</span>
            <span class=k>elif</span> <span class=nb>len</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>FILES</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span> <span class=ow>and</span> <span class=nb>len</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>body</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
                <span class=n>data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>body</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=n>encoding</span><span class=o>=</span><span class=s1>'utf-8'</span><span class=p>))</span>
                <span class=n>data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=s1>'json'</span><span class=p>])</span> <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=p>{}</span>
            <span class=c1># 자바스크립트 해시 키 제거</span>
            <span class=n>remove_javascript_hashkey</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</code></pre></div></section><aside class=article-nav><a class="article-nav-left article-nav-left-empty"></a><div class=clear></div></aside><div class=article-comment><div class=comment-title><div class=comment-count></div></div><div class=comment-input><div class=comment-body><textarea id=comment-content placeholder="Comment (at least 3 chars)" type=text></textarea></div><div class=comment-foot><input id=comment-username placeholder="Name (optional)" type=text><input id=comment-email placeholder="Email (optional)" type=text><button id=comment-submit-button onclick=onClickSubmitCommentButton()>Submit</button></div></div><div class=comment-list></div></div> </div></main><footer class=footer><div class=container><div class=credits><div class=group-container><div class=group><a class=avatar href=/authors-information.html><img class=avatar src="https://avatars1.githubusercontent.com/u/21299773?s=460&v=4"></a></div><div class=group><a href=/category/authors-music.html> Author's Music </a><a href=/category/authors-mixset.html> Author's Mixset </a><a href=/category/authors-development.html> Author's Development </a></div></div><div class=group-container><div class=group><a href=/category/music-articles.html> Music Articles </a><a href=/category/development-articles.html> Development Articles </a></div><div class=group><a href=/archives.html> Find in Archives </a><a href=/categories.html> Find in Categories </a><a href=/tags.html> Find in Tags </a></div><div class=group><a href=https://github.com/peppy0510 target=_blank>GitHub</a></div></div></div></div></footer></body></html>