<!DOCTYPE html><html lang=en><head><title>MUTEKLAB - Python Web Minification</title><meta charset=utf-8><meta content="IE=edge,chrome=1" http-equiv=X-UA-Compatible><meta charset=utf-8 content=text/html http-equiv=Content-Type><meta content="Taehong Kim" name=author><meta content=origin name=referrer><meta content=Pelican name=generator><meta content=#000000 name=theme-color><meta content=#000000 name=msapplication-navbutton-color><meta content=#000000 name=apple-mobile-web-app-status-bar-style><meta content=True name=HandheldFriendly><meta content="width=device-width, initial-scale=1.0" name=viewport><meta content=UJrW4UdiO-oEmH_o6fBNi4az0ooqxSFHNJs6RxFqa80 name=google-site-verification><link href=http://muteklab.com/python-web-minification.html rel=canonical><meta content="Python으로 웹 콘텐츠를 minification 하는 방법을 소개합니다. HTML, JavaScript, CSS 등의 소스 파일에서 불필요한 공백 문자나 주석을 제거하여 네트워크 …" name=description><link href=/static/images/favicon.ico rel="shortcut icon"><script src=https://www.gstatic.com/firebasejs/7.6.1/firebase-app.js></script><script src=https://www.gstatic.com/firebasejs/7.6.1/firebase-firestore.js></script><script src=https://www.gstatic.com/firebasejs/7.6.1/firebase-analytics.js></script><!-- <script async src="https://www.googletagmanager.com/gtag/js?id=G-NCJZCXBKLS"></script> --><script src=/static/js/jquery.min.js type=text/javascript></script><script src=/static/js/common-menu.min.js type=text/javascript></script><script src=/static/js/md5.min.js></script><script src=/static/js/moment-with-locales.min.js type=text/javascript></script><link href=/static/css/code_blocks/github.min.css rel=stylesheet type=text/css><link href=/static/css/common.min.css rel=stylesheet type=text/css><link href=/static/css/common-menu.min.css rel=stylesheet type=text/css><link href=/static/css/common-icons.min.css rel=stylesheet type=text/css><link href=/static/css/common-alert.min.css rel=stylesheet type=text/css><link href=/static/css/common-footer.min.css rel=stylesheet type=text/css><link href=/static/css/common-pagination.min.css rel=stylesheet type=text/css><link href=/static/css/article-content.min.css rel=stylesheet type=text/css><link href=/static/css/article-loop.min.css rel=stylesheet type=text/css><link href=/static/css/article-nav.min.css rel=stylesheet type=text/css><link href=/static/css/article-comment.min.css rel=stylesheet type=text/css><script type=text/javascript>let ua=window.navigator.userAgent;if(ua.indexOf('MSIE ')>0||ua.indexOf('Trident/')>0||ua.indexOf('Edge/')>0){$('head').append('<script src="/static/js/audio-player-ie.min.js"><\/script>');$('head').append('<script src="/static/js/youtube-embed-ie.min.js"><\/script>');}else{$('head').append('<script src="/static/js/comment.min.js""><\/script>');$('head').append('<script src="/static/js/audio-player.min.js"><\/script>');$('head').append('<script src="/static/js/youtube-embed.min.js"><\/script>');}
var firebaseConfig={apiKey:"AIzaSyCKt3z0JCmxteYhxs93rsMtOqkb4_I8Em4",authDomain:"muteklab-com.firebaseapp.com",databaseURL:"https://muteklab-com.firebaseio.com",projectId:"muteklab-com",storageBucket:"muteklab-com.appspot.com",messagingSenderId:"358862433613",appId:"1:358862433613:web:6bc27b27018c4ae5",measurementId:"G-NCJZCXBKLS"};firebase.initializeApp(firebaseConfig);firebase.analytics();</script><meta content=article property=og:type><meta content="Python Web Minification" property=og:title><meta content="Python으로 웹 콘텐츠를 minification 하는 방법을 소개합니다. HTML, JavaScript, CSS 등의 소스 파일에서 불필요한 공백 문자나 주석을 제거하여 네트워크 …" property=og:description><meta content=http://muteklab.com/static/images/favicon.png property=og:image><meta content=http://muteklab.com/python-web-minification.html property=og:url><meta content="Taehong Kim" property=article:author><meta content="2019-08-22 00:00:00+09:00" property=article:published_time></head><body><div class=navbar><div class=container><a href=/ class=navbar-brand><img src=/static/images/logo-muteklab.svg></a><div class=navbar-header><button class=navbar-toggle><span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button></div><div class=navbar-modal-mask></div><div class=navbar-menu><div class=dropdown><button class=dropdown-toggle> Author<b class=caret></b></button><div class=dropdown-menu><a href=/authors-information.html>Information</a><div class=divider></div><a href=/category/authors-music.html>Music</a><a href=/category/authors-mixset.html>Mixset</a><a href=/category/authors-development.html>Development</a></div></div><div class=dropdown><button class=dropdown-toggle> Articles<b class=caret></b></button><div class=dropdown-menu><a href=/category/music-articles.html>Music</a><a href=/category/development-articles.html>Development</a></div></div><div class=dropdown><button class=dropdown-toggle> Find<b class=caret></b></button><div class=dropdown-menu><a href=/archives.html>Archives</a><a href=/categories.html>Categories</a><a href=/tags.html>Tags</a></div></div></div></div></div><header class=article-header><div class=container><div class=header-title>Python Web Minification</div><!-- <span class="blog-description"></span> --><span class=article-meta><div class=group><a href=/category/development-articles.html> Development Articles </a><span class=seperator>|</span><time datetime=2019-08-22>2019-08-22</time></div></span></div></header><input id=article-url type=hidden value=python-web-minification.html><main class=content><div class=container><section class=article-content><p>Python으로 웹 콘텐츠를 minification 하는 방법을 소개합니다. HTML, JavaScript, CSS 등의 소스 파일에서 불필요한 공백 문자나 주석을 제거하여 네트워크 전송량을 줄이는 방법입니다. 우선 예제에 필요한 라이브러리를 모두 설치합니다.</p><div class=highlight><pre><span></span><code>pip install jsmin htmlmin beautifulsoup4
</code></pre></div><h6></h6><h5>JavaScript or CSS Minification</h5><p>jsmin 라이브러리를 사용하여 minification 합니다.</p><div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>jsmin</span> <span class=kn>import</span> <span class=n>jsmin</span>

<span class=n>content</span> <span class=o>=</span> <span class=s1>'javascript or css content'</span>

<span class=n>content</span> <span class=o>=</span> <span class=n>jsmin</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</code></pre></div><p>단, CSS minification에는 htmlmin 라이브러리를 사용하는 것이 좋을 수도 있습니다.. 파일을 읽어 처리해야 한다면 다음과 같이 하면 됩니다.</p><div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>jsmin</span> <span class=kn>import</span> <span class=n>jsmin</span>

<span class=n>path</span> <span class=o>=</span> <span class=s1>'path.js or path.css'</span>

<span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=s1>'rb'</span><span class=p>)</span> <span class=k>as</span> <span class=n>file</span><span class=p>:</span>
    <span class=n>content</span> <span class=o>=</span> <span class=n>file</span><span class=o>.</span><span class=n>read</span><span class=p>()</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>'utf-8'</span><span class=p>)</span>
    <span class=n>content</span> <span class=o>=</span> <span class=n>jsmin</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>

<span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=s1>'wb'</span><span class=p>)</span> <span class=k>as</span> <span class=n>file</span><span class=p>:</span>
    <span class=n>file</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>content</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>'utf-8'</span><span class=p>))</span>
</code></pre></div><p>참고로 바이너리 모드로 파일을 읽은 후 utf-8 인코딩을 하지 않으면, 한글과 특수문자 등의 오류가 발생할 수 있으므로 주의해야 합니다.</p><h6></h6><h5>HTML Minification</h5><p>htmlmin 라이브러리를 사용하여 minification 합니다.</p><div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>htmlmin</span>

<span class=n>content</span> <span class=o>=</span> <span class=s1>'html content'</span>

<span class=n>content</span> <span class=o>=</span> <span class=n>htmlmin</span><span class=o>.</span><span class=n>minify</span><span class=p>(</span><span class=n>content</span><span class=p>,</span> <span class=n>remove_empty_space</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</code></pre></div><p>HTML 소스 내에 존재하는 script나 style은 htmlmin으로 처리되지 않습니다. BeautifulSoup을 사용하여 style과 script 태그의 내용을 찾아 별도로 처리하면 됩니다.</p><div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>jsmin</span> <span class=kn>import</span> <span class=n>jsmin</span>
<span class=kn>from</span> <span class=nn>bs4</span> <span class=kn>import</span> <span class=n>BeautifulSoup</span>


<span class=n>content</span> <span class=o>=</span> <span class=s1>'html content'</span>

<span class=n>soup</span> <span class=o>=</span> <span class=n>BeautifulSoup</span><span class=p>(</span><span class=n>content</span><span class=p>,</span> <span class=s1>'html.parser'</span><span class=p>)</span>

<span class=k>for</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>soup</span><span class=o>.</span><span class=n>find_all</span><span class=p>(</span><span class=s1>'style'</span><span class=p>):</span>
    <span class=n>v</span><span class=o>.</span><span class=n>string</span> <span class=o>=</span> <span class=n>jsmin</span><span class=p>(</span><span class=n>v</span><span class=o>.</span><span class=n>get_text</span><span class=p>())</span>

<span class=k>for</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>soup</span><span class=o>.</span><span class=n>find_all</span><span class=p>(</span><span class=s1>'script'</span><span class=p>):</span>
    <span class=n>v</span><span class=o>.</span><span class=n>string</span> <span class=o>=</span> <span class=n>jsmin</span><span class=p>(</span><span class=n>v</span><span class=o>.</span><span class=n>get_text</span><span class=p>())</span>

<span class=n>content</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>soup</span><span class=p>)</span>
</code></pre></div><p>htmlmin으로 주석은 제거되지 않습니다. 간혹 유명 포털 사이트 브라우징 시 HTML 소스보기 하더라도 많은 주석을 볼 수 있는 경우가 있습니다. 주석에는 개발자가 미처 생각하지 못한 보안 사항, 백도어의 힌트가 포함될 수도 있습니다. 주석을 제거하고 싶다면 다음과 같이 정규식을 사용할 수 있습니다. 단, HTML 조건문에서 사용되는 <code>![]</code> 문자가 들어 있다면 제거되지 않는 정규식이므로 주의합니다.</p><div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>re</span>

<span class=n>content</span> <span class=o>=</span> <span class=s1>'html content'</span>

<span class=n>ptrn</span> <span class=o>=</span> <span class=sa>r</span><span class=s1>'(&lt;!--)([^!^[^]]*)(--&gt;)'</span>
<span class=n>content</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=n>ptrn</span><span class=p>,</span> <span class=s1>''</span><span class=p>,</span> <span class=n>content</span><span class=p>,</span> <span class=n>flags</span><span class=o>=</span><span class=n>re</span><span class=o>.</span><span class=n>DOTALL</span><span class=p>)</span>
</code></pre></div><p>완벽하지 않은 정규식이며, 추후에 더 나은 방법을 발견하면 수정하도록 하겠습니다. 본문 내용자체에 주석을 설명하기 위해 <code>&lt;!--</code>와 <code>--&gt;</code>가 표기되어 있다면 의도하지 않게 제거될 수 있으므로 주의해야 합니다.</p><h6></h6><h5>응용하기</h5><p>서비스를 유지 관리하는 측면에서 반복되는 minification 작업은 성가신 일입니다. 또한, 공백문자 제거로 인하여 예상하지 못한 결과물의 변형이 있을 수 있으므로, 소스 코드 수정 시 수시로 확인하는 과정이 필요하며, 응답 시 매번 minification하기 위해서는 응답속도가 증가하는 문제가 발생합니다. 이러한 문제를 해결하기 위해 minify된 파일을 메모리 데이터베이스에 캐싱하여 사용하는 방법이 있습니다. 즉, 파일 수정시간을 참조하여 캐시가 없거나 파일 수정시간 갱신 시에만 minify하여 캐싱하고 이로부터 읽어 응답할 수 있습니다. 이에 더하여 서버 측에서 클라이언트 캐시 응답을 처리하기 위해서는 파일 수정시간 참조가 필수적이므로 이를 함께 처리하도록 구현하면 보다 빠른 응답 속도를 기대할 수 있습니다.</p></section><aside class=article-nav><a class=article-nav-left href=/html-templatee-linter-sayong-si-balsaenghaneun-munjehaegyeol.html><i class="ic ic-arrow-left"></i><div class=article-nav-teaser><h2 class=article-nav-title>HTML Template에 Linter 사용 시 발생하는 문제해결</h2><p class=article-nav-excerpt>Django, Jinja 등의 HTML Template에 Linter 사용 시 발생하는 문제 해결 방법을 소개합니다. Template에 HTML...</p></div></a><div class=article-nav-seperator></div><a class=article-nav-right href=/pythoneuro-sinhoceori-pilteo-guhyeonhagi.html><div class=article-nav-teaser><h2 class=article-nav-title>Python으로 신호처리 필터 구현하기</h2><p class=article-nav-excerpt>신호처리의 기본이 되는 필터를 Python으로 구현해봤습니다. Matlab 예제로 많이 소개되는 필터 구현체를 참고 하였습니다. FIR Filter from scipy …</p></div><i class="ic ic-arrow-right"></i></a><div class=clear></div></aside><div class=article-comment><div class=comment-title><div class=comment-count></div></div><div class=comment-input><div class=comment-body><textarea id=comment-content placeholder="Comment (at least 3 chars)" type=text></textarea></div><div class=comment-foot><input id=comment-username placeholder="Name (optional)" type=text><input id=comment-email placeholder="Email (optional)" type=text><button id=comment-submit-button onclick=onClickSubmitCommentButton()>Submit</button></div></div><div class=comment-list></div></div> </div></main><footer class=footer><div class=container><div class=credits><div class=group-container><div class=group><a class=avatar href=/authors-information.html><img class=avatar src="https://avatars1.githubusercontent.com/u/21299773?s=460&v=4"></a></div><div class=group><a href=/category/authors-music.html> Author's Music </a><a href=/category/authors-mixset.html> Author's Mixset </a><a href=/category/authors-development.html> Author's Development </a></div></div><div class=group-container><div class=group><a href=/category/music-articles.html> Music Articles </a><a href=/category/development-articles.html> Development Articles </a></div><div class=group><a href=/archives.html> Find in Archives </a><a href=/categories.html> Find in Categories </a><a href=/tags.html> Find in Tags </a></div><div class=group><a href=https://github.com/peppy0510 target=_blank>GitHub</a></div></div></div></div></footer></body></html>